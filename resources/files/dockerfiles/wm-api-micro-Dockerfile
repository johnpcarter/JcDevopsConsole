FROM softwareag/microgateway-trial:10.11

LABEL MAINTAINER="John Carter (john.carter@softwareag.com)" \
DESCRIPTION="Micro Gateway with secret sauce" \
COMMENT="Interogates companion MSR to dynamically figure out what API's to manage" \
CUSTOM="false" \
SAG="true" \
TYPE="apimg" \
PRIMARY_PORT="4485" \
BUILD="112"

USER root

RUN apk add curl

EXPOSE 4485

#USER sagadmin

COPY --chown=1724 docker-init.sh /
COPY --chown=1724 docker-stop.sh /
COPY --chown=1724 docker-health-check.sh /

RUN chmod u+x /docker-init.sh
RUN chmod u+x /docker-stop.sh
RUN chmod u+x /docker-health-check.sh

COPY --chown=1724 config/system-settings.yml /opt/sag/Microgateway/config/system-settings.yml
COPY --chown=1724 config/config.yml /opt/sag/Microgateway/config/config.yml
#COPY --chown=sagadmin:sagadmin config/users.cnf /opt/sag/Microgateway/config/users.cnf

ENTRYPOINT ["/docker-init.sh"]

HEALTHCHECK --interval=30s --timeout=30s --start-period=20s --retries=6 \
	CMD /docker-health-check.sh